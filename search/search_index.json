{"config":{"lang":["en"],"separator":"[\\s\\u200b\\u3000\\-\u3001\u3002\uff0c\uff0e\uff1f\uff01\uff1b]+","pipeline":["stemmer"]},"docs":[{"location":"","title":"BEP \u4e2d\u6587\u7ffb\u8bd1","text":"<p>BT \u534f\u8bae bep \u7684\u4e2d\u6587\u7ffb\u8bd1</p> <p>https://www.bittorrent.org/index.html</p> <p>\u672c\u6587\u4e0d\u4f1a\u7ffb\u8bd1 <code>tracker</code>\uff0c <code>BitTorrent</code>\uff0c<code>bencode</code> \u7b49\u7279\u6b8a\u8bcd\u6c47</p> <p>\u672c\u6587\u4e2d\u53ef\u80fd\u4f1a\u4f7f\u7528 python3 \u7684\u6982\u5ff5\u5bf9 BT \u534f\u8bae\u4e2d\u7684\u4e00\u4e9b\u6982\u5ff5\u8fdb\u884c\u89e3\u91ca\u3002</p>"},{"location":"bep_0003/","title":"bep 3 BitTorrent \u534f\u8bae\u89c4\u8303","text":"<p>bep 3 \u539f\u59cb\u94fe\u63a5</p> <p>BitTorrent \u662f\u4e00\u79cd\u5206\u53d1\u6587\u4ef6\u7684\u534f\u8bae\u3002\u5b83\u901a\u8fc7 URL \u8bc6\u522b\u5185\u5bb9\uff0c\u65e8\u5728\u4e0e\u7f51\u7edc\u65e0\u7f1d\u96c6\u6210\u3002 \u4e0e\u666e\u901a HTTP \u76f8\u6bd4\uff0c\u5b83\u7684\u4f18\u52bf\u5728\u4e8e\uff0c\u5f53\u591a\u4e2a\u4e0b\u8f7d\u8005\u540c\u65f6\u4e0b\u8f7d\u540c\u4e00\u6587\u4ef6\u65f6\uff0c \u4e0b\u8f7d\u8005\u4f1a\u76f8\u4e92\u4e0a\u4f20\uff0c\u4ece\u800c\u4f7f\u6587\u4ef6\u6e90\u80fd\u591f\u652f\u6301\u5927\u91cf\u4e0b\u8f7d\u8005\uff0c\u800c\u53ea\u9700\u9002\u5ea6\u589e\u52a0\u5176\u8d1f\u8f7d\u3002</p>"},{"location":"bep_0003/#bittorrent","title":"\u5206\u53d1 BitTorrent \u6587\u4ef6\u9700\u8981\u4ee5\u4e0b\u7684\u7ec4\u4ef6","text":"<ol> <li>\u4e00\u4e2a\u666e\u901a\u7684\u6587\u4ef6\u670d\u52a1\u5668</li> <li>\u4e00\u4e2a\u9759\u6001\u79cd\u5b50\u6587\u4ef6</li> <li>\u4e00\u4e2a BitTorrent tracker</li> <li>\u4e00\u4e2a\u201c\u539f\u59cb\u201d\u4e0b\u8f7d\u8005</li> <li>\u7ec8\u7aef\u7528\u6237\u6d4f\u89c8\u5668</li> <li>\u7ec8\u7aef\u7528\u6237\u4e0b\u8f7d\u5668</li> </ol>"},{"location":"bep_0003/#_1","title":"\u4e3a\u4e86\u5206\u53d1\u6587\u4ef6\uff0c\u9700\u8981\u8fdb\u884c\u4ee5\u4e0b\u6d41\u7a0b","text":"<ol> <li>\u542f\u52a8\u4e00\u4e2a <code>tracker</code></li> <li>\u8fd0\u884c\u4e00\u4e2a\u666e\u901a\u7684 web \u670d\u52a1\u5668\uff0c\u6bd4\u5982 apache\u3002</li> <li>\u5c06 <code>.torrent</code> \u6269\u5c55\u540d\u8ddf mime type <code>application/x-bittorrent</code> \u8fdb\u884c\u5173\u8054\u3002</li> <li>\u4ece\u8981\u5206\u53d1\u7684\u6587\u4ef6\u548c tracker \u5730\u5740\u751f\u6210\u79cd\u5b50\u6587\u4ef6\u3002</li> <li>\u901a\u8fc7 web \u670d\u52a1\u5668\u7b49\u65b9\u5f0f\u5206\u53d1\u79cd\u5b50\u6587\u4ef6\u3002</li> <li>\u4ee5\u5b8c\u6574\u7684\u6587\u4ef6\u548c\u79cd\u5b50\u6587\u4ef6\u542f\u52a8\u4e0b\u8f7d\u5668\uff0c\u4fd7\u79f0\u505a\u79cd\u3002</li> </ol>"},{"location":"bep_0003/#_2","title":"\u4e3a\u4e86\u8fdb\u884c\u4e0b\u8f7d\uff0c\u4e0b\u8f7d\u8005\u9700\u8981\u5982\u4e0b\u7684\u64cd\u4f5c","text":"<ol> <li>\u5b89\u88c5\u652f\u6301 BitTorrent \u534f\u8bae\u7684\u4e00\u4e2a\u4e0b\u8f7d\u5668</li> <li>\u4e0b\u8f7d\u79cd\u5b50\u6587\u4ef6</li> <li>\u5c06\u79cd\u5b50\u6587\u4ef6\u6dfb\u52a0\u5230\u4e0b\u8f7d\u5668</li> <li>\u9009\u62e9\u4e0b\u8f7d\u8def\u5f84\uff0c\u6216\u8005\u4ece\u4e4b\u524d\u672a\u5b8c\u6210\u7684\u4e0b\u8f7d\u6062\u590d\u4e0b\u8f7d</li> <li>\u7b49\u5f85\u4e0b\u8f7d\u5b8c\u6210</li> <li>\u5173\u95ed\u5ba2\u6237\u7aef\uff0c\u6216\u8005\u4fdd\u6301\u5ba2\u6237\u7aef\u542f\u52a8\u72b6\u6001\u8fdb\u884c\u505a\u79cd</li> </ol>"},{"location":"bep_0003/#bencoding","title":"bencoding\uff0c\u79cd\u5b50\u6587\u4ef6\u7684\u7f16\u7801\u683c\u5f0f","text":"<p>bencoding \u5305\u542b\u56db\u79cd\u6570\u636e\u7c7b\u578b</p> <ul> <li>\u5b57\u7b26\u4e32\uff08\u4e8c\u8fdb\u5236\u5b57\u7b26\u4e32\uff09\u3002\u7f16\u7801\u4e3a \u957f\u5ea6+ <code>:</code> + \u5b57\u7b26\u4e32\u5185\u5bb9\u3002 \u4f8b\u5982 <code>4:spam</code> \u4ee3\u8868 <code>'spam'</code></li> <li>\u6574\u6570\u3002 \u4ee5\u4e3a <code>i</code> \u5f00\u5934\uff0c<code>e</code>\u7ed3\u5c3e\uff0c\u4e2d\u95f4\u4e3a\u6574\u6570\u7684\u5341\u8fdb\u5236\u683c\u5f0f\u3002\u6bd4\u5982 <code>i3e</code> \u4e3a <code>3</code>, <code>i-3e</code> \u4e3a <code>-3</code>\uff0c   \u6574\u6570\u6ca1\u6709\u5927\u5c0f\u9650\u5236\u3002 \u4e0d\u5141\u8bb8\u4f7f\u7528<code>i-0e</code>\uff0c \u53ea\u6709 <code>i0</code> \u5408\u6cd5\u3002 \u9664\u4e86 <code>0</code> \u7684\u7f16\u7801 <code>i0e</code>   \u4ee5\u5916\u4e0d\u53ef\u4ee5\u6709\u524d\u5bfc <code>0</code>\uff0c <code>i03e</code> \u4e0d\u5408\u6cd5\u3002</li> <li>\u5217\u8868\u3002 \u4ee5 <code>l</code> \u5f00\u5934\uff0c <code>e</code> \u7ed3\u675f\uff0c\u4e2d\u95f4\u987a\u5e8f\u7a7f\u63d2 bencode   \u683c\u5f0f\u7684\u5143\u7d20\u5185\u5bb9\u3002\u6bd4\u5982 <code>['spam', 'eggs']</code> \u7f16\u7801\u4e3a <code>l4:spam4:eggse</code></li> <li>\u5b57\u5178\u3002\u5b57\u5178\u662f\u4ee5 <code>d</code> \u5f00\u5934\uff0c <code>e</code> \u7ed3\u5c3e\u7684\u952e\u503c\u5bf9\u3002 \u6309\u7167\u952e-\u503c\u7684\u987a\u5e8f\u7f16\u7801\u3002   <code>{'cow': 'moo', 'spam': 'eggs'}</code>   \u7f16\u7801\u4e3a <code>d3:cow3:moo4:spam4:eggse</code>\u3002 <code>{'spam': ['a', 'b']}</code> \u7f16\u7801\u4e3a <code>d4:spaml1:a1:bee</code>\u3002   \u5b57\u5178\u4e2d\u7684\u952e\u5fc5\u987b\u552f\u4e00\u3002   \u5b57\u5178\u7684\u952e\u5fc5\u987b\u4e3a\u5b57\u7b26\u4e32\uff0c\u800c\u4e14\u5fc5\u987b\u6309\u987a\u5e8f\u51fa\u73b0\u3002(sorted as raw strings, not alphanumerics)</li> </ul>"},{"location":"bep_0003/#_3","title":"\u79cd\u5b50\u6587\u4ef6","text":"<p>\u79cd\u5b50\u6587\u4ef6 \uff08.torrent \u6587\u4ef6\uff09 \u662f\u4e00\u4e2a bencode \u7f16\u7801\u7684\u5b57\u5178\uff0c\u5e76\u4e14\u5305\u542b\u4ee5\u4e0b\u7684 key\uff1a</p> <p><code>announce</code> tracker url \u5730\u5740</p> <p><code>info</code> \u4e00\u4e2a\u5b57\u5178\uff0c\u5e76\u4e14\u9700\u8981\u5305\u542b\u4ee5\u4e0b\u7684 key\uff1a</p>"},{"location":"bep_0003/#info-dictionary","title":"info dictionary","text":"<p><code>name</code>: \u4e00\u4e2a utf-8 \u7f16\u7801\u7684 bencode \u5b57\u7b26\u4e32\uff0c\u5efa\u8bae\u7528\u6237\u4fdd\u5b58\u6587\u4ef6\u6216\u8005\u6587\u4ef6\u5939\u7684\u8def\u5f84\u3002</p> <p><code>piece length</code>\uff1a\u533a\u5757\u957f\u5ea6\u3002\u4e3a\u4e86\u8fdb\u884c\u4f20\u8f93\uff0c\u6587\u4ef6\u4f1a\u88ab\u5206\u4e3a\u56fa\u5b9a\u5927\u5c0f\u7684\u533a\u5757\u3002 \u6700\u540e\u4e00\u4e2a\u533a\u5757\u9664\u5916\uff0c\u7531\u4e8e\u6587\u4ef6\u957f\u5ea6\u539f\u56e0\uff0c\u6700\u540e\u4e00\u4e2a\u533a\u5757\u53ef\u80fd\u4f1a\u88ab\u622a\u65ad\u3002 \u6bd4\u8f83\u5e38\u89c1\u7684\u533a\u5757\u957f\u5ea6\u662f\u4e8c\u7684\u5e42\uff082^n\uff09\uff0c\u975e\u4e8c\u7684\u5e42\u4e5f\u662f\u5141\u8bb8\u7684\u503c\u3002\u5e38\u89c1\u503c\u6709 2^18 = 256K \u7b49\u3002</p> <p><code>pieces</code>\uff1a\u533a\u5757\u54c8\u5e0c\uff0c\u957f\u5ea6\u4e3a 20 \u7684\u6b63\u6574\u6570\u500d\u3002\u6bcf 20 \u5b57\u8282\u4e3a\u5bf9\u5e94\u533a\u5757\u7684 sha1 \u54c8\u5e0c\u503c\u3002 \u6bd4\u5982 <code>pieces[0:20]</code> \u4e3a\u7b2c\u4e00\u4e2a\u54c8\u5e0c\uff0c\u5bf9\u5e94\u7b2c\u4e00\u4e2a\u533a\u5757\u7684 sha1 \u54c8\u5e0c\u503c\u3002 <code>pieces[20:40]</code> \u4e3a\u7b2c\u4e8c\u4e2a\u54c8\u5e0c\u503c\uff0c\u4e3a\u7b2c\u4e8c\u4e2a\u533a\u5757\u7684 sha1 \u54c8\u5e0c\u3002</p> <p>\u5bf9\u4e8e\u5355\u6587\u4ef6\u79cd\u5b50\uff0c\u8fd8\u5fc5\u987b\u5305\u542b <code>length</code> \u952e\uff0c\u8868\u793a\u79cd\u5b50\u9501\u5bf9\u5e94\u7684\u5355\u4e2a\u6587\u4ef6\u7684\u5927\u5c0f\u3002</p> <p>\u5bf9\u4e8e\u591a\u6587\u4ef6\u79cd\u5b50\uff0c\u8fd8\u5fc5\u987b\u5305\u542b <code>files</code> \u952e\uff0c<code>files</code> \u662f\u4e00\u4e2a\u5b57\u5178\u7ec4\u6210\u7684\u5217\u8868\uff0c\u6bcf\u4e2a\u5b57\u5178\u5fc5\u9700\u5305\u542b\u4ee5\u4e0b\u7684 keys\uff1a</p> <p><code>length</code>\uff1a \u5f53\u524d\u6587\u4ef6\u7684\u957f\u5ea6\u3002</p> <p><code>path</code>\uff1a\u4e00\u4e2a <code>list[str]</code>, \u7531 UTF-8 \u5b57\u7b26\u4e32\u7ec4\u6210\u7684\u5217\u8868\uff0c\u6700\u540e\u4e00\u4e2a\u5143\u7d20\u4e3a\u6587\u4ef6\u540d\uff0c\u524d\u9762\u7684\u5143\u7d20\u4e3a\u6587\u4ef6\u5939\u5c42\u7ea7\u3002</p> <p>\u5355\u6587\u4ef6\u79cd\u5b50\u7684 <code>name</code> \u4e3a\u79cd\u5b50\u6240\u5bf9\u5e94\u7684\u6587\u4ef6\uff0c\u591a\u6587\u4ef6\u79cd\u5b50\u7684 <code>name</code> \u4e3a\u5bf9\u5e94\u6587\u4ef6\u5939\u7684\u540d\u79f0\u3002</p>"},{"location":"bep_0003/#trackers","title":"Trackers","text":"<p>\u5ba2\u6237\u7aef\u4f7f\u7528 <code>GET</code> \u8bf7\u6c42\u50cf tracker \u8bf7\u6c42\u5176\u4ed6\u8282\u70b9\uff0c\u8bf7\u6c42\u5fc5\u9700\u5305\u542b\u4ee5\u4e0b\u7684\u53c2\u6570\u3002</p> <p>\uff08 \u5173\u4e8e HTTP \u8bf7\u6c42\u548c GET \u8bf7\u6c42\u7684\u53c2\u6570\uff0c\u53ef\u4ee5\u67e5\u770b\u7ef4\u57fa\u767e\u79d1 \uff09</p>"},{"location":"bep_0003/#info_hash","title":"info_hash","text":"<p>20 \u5b57\u8282\u957f\u5ea6\u7684 sha1 \u54c8\u5e0c\uff0c\u5bf9\u79cd\u5b50\u6587\u4ef6\u7684 <code>info</code> \u90e8\u5206\u8fdb\u884c\u54c8\u5e0c\u751f\u6210\u3002\u5728HTTP query\u4e2d\u9700\u8981\u8fdb\u884c\u8f6c\u4e49\u3002</p> <p>\u7531\u4e8ebencode\u7684\u7279\uff0c\u53ef\u4ee5\u5148\u89e3\u6790\u6574\u4e2a\u79cd\u5b50\u6587\u4ef6\uff0c\u5bf9 <code>info</code> \u90e8\u5206\u8fdb\u884cbencode\u7f16\u7801\uff0c \u7136\u540e\u518d\u8ba1\u7b97\u5bf9\u5e94 sha1 \u54c8\u5e0c\u3002 info_hash \u53ea\u5e94\u5728\u79cd\u5b50\u6587\u4ef6\u7684 bencode \u6b63\u786e\u7684\u60c5\u51b5\u4e0b\u8fdb\u884c\u8ba1\u7b97\uff0c\u5982\u679c\u79cd\u5b50\u6587\u4ef6\u7684 bencode \u7f16\u7801\u9519\u8bef\uff0c\u89e3\u6790\u5668\u5fc5\u9700\u62d2\u7edd\u5bf9\u5e94\u7684\u79cd\u5b50\u6587\u4ef6\u3002</p> <p>Tip</p> <p>\u8fd9\u91cc\u7684 info_hash \u4e0d\u662f\u5e38\u89c1\u7684 40 \u5b57\u8282\u957f\u5ea6\u7684 info_hash \u5b57\u7b26\u4e32\uff0c\u800c\u662f\u539f\u59cb\u7684\u4e8c\u8fdb\u5236\u6570\u636e\u3002</p> <p>\u5e38\u89c1\u7684 40 \u5b57\u8282\u957f\u5ea6\u7684 info_hash \u5b9e\u9645\u4e0a\u662f\u539f\u59cb info_hash \u7684 hex \u7f16\u7801\u7ed3\u679c\u3002</p> <p>\u4ee5 ubuntu-24.04-live-server-amd64 \u4e3a\u4f8b\uff0c \u8fd9\u4e2a\u79cd\u5b50\u7684 info_hash \u7684\u539f\u59cb\u4e8c\u8fdb\u5236\u503c\u4e3a [129, 175, 7, 73, 25, 21, 65, 93, 173, 69, 248, 124, 12, 42, 229, 47, 174, 146, 192, 107]</p> <p>\u4f46\u662f\u7531\u4e8e\u4e8c\u8fdb\u5236\u5185\u5bb9\u4e0d\u4e00\u5b9a\u80fd\u591f\u5bf9\u5e94\u53ef\u663e\u793a\u7684\u5185\u5bb9\uff0c\u6240\u4ee5\u4e00\u822c\u4ee5 hex \u7f16\u7801\u4e3a <code>81af07491915415dad45f87c0c2ae52fae92c06b</code>\u3002</p> <pre><code>import hashlib\nfrom urllib.parse import quote\n\nprint(quote(bytes.fromhex(\"81af07491915415dad45f87c0c2ae52fae92c06b\")))\n\n# \u6216\u8005\n\nprint(quote(hashlib.sha1(...).digest()))\n</code></pre> <p>\u4f7f\u7528 python \u4ece\u79cd\u5b50\u4e2d\u8ba1\u7b97 info_hash \u7684\u4f8b\u5b50\uff1a</p> <pre><code>import hashlib\nfrom bencode2 import bdecode, bencode\n\nwith open('ubuntu-24.04-live-server-amd64.torrent', 'rb') as f:\n    data = bdecode(f.read())\n\ninfo_hash = hashlib.sha1(bencode(data[b'info'])).digest()\n</code></pre> <p>\uff08\u9700\u8981\u4f7f\u7528 pip \u5b89\u88c5 bencode2)</p>"},{"location":"bep_0003/#peer_id","title":"peer_id","text":"<p>\u4e00\u4e2a 20 \u5b57\u8282\u957f\u5ea6\u7684\u5b57\u7b26\u4e32\uff0c\u4ee3\u8868\u5ba2\u6237\u7aef\u7684 ID\u3002\u6bcf\u4e2a\u5ba2\u6237\u7aef\u5e94\u8be5\u4e3a\u6bcf\u4e2a\u4e0b\u8f7d\u90fd\u751f\u6210\u4e00\u4e2a\u968f\u673a ID \u3002 \u5728URL\u4e2d\u9700\u8981\u8fdb\u884c\u8f6c\u4e49\u3002</p> <p>Tip</p> <p>\u5e38\u89c1\u5ba2\u6237\u7aef\u7684 peer id \u4f1a\u9075\u5faa\u4e00\u5b9a\u7684\u89c4\u8303\uff0c\u4ee5\u65b9\u4fbf tracker \u5224\u65ad\u8bf7\u6c42\u6240\u5bf9\u5e94\u7684\u5ba2\u6237\u7aef\u3002</p>"},{"location":"bep_0003/#ip","title":"ip","text":"<p>\u53ef\u9009\u53c2\u6570\uff0c\u7528\u4e8e\u5411tracker\u6c47\u62a5\u5ba2\u6237\u7aef\u6240\u5728\u7684ip\u5730\u5740\u3002</p>"},{"location":"bep_0003/#port","title":"port","text":"<p>\u5ba2\u6237\u7aef\u7684bt\u534f\u8bae\u76d1\u542c\u7a97\u53e3\u3002</p> <p>Tip</p> <p>\u51fa\u4e8e\u5b89\u5168\u8003\u8651\uff0c\u8bb8\u591a tracker \u7981\u6b62\u5ba2\u6237\u7aef\u4f7f\u7528\u7279\u6743\u7aef\u53e3\u548c\u4e00\u4e9b\u5176\u4ed6\u5e38\u89c1\u534f\u8bae\u7684\u7aef\u53e3\u3002\u5efa\u8bae\u4f7f\u7528\u9ad8\u4f4d\u968f\u673a\u7aef\u53e3\u3002</p>"},{"location":"bep_0003/#uploaded","title":"uploaded","text":"<p>\u5ba2\u6237\u7aef\u76ee\u524d\u4e3a\u6b62\u7684\u4e0a\u4f20\u91cf\uff0c\u4ee5\u5341\u8fdb\u5236\u5b57\u7b26\u4e32\u683c\u5f0f\u7f16\u7801\u3002</p>"},{"location":"bep_0003/#downloaded","title":"downloaded","text":"<p>\u5ba2\u6237\u7aef\u76ee\u524d\u4e3a\u6b62\u7684\u4e0b\u8f7d\u91cf\uff0c\u4ee5\u5341\u8fdb\u5236\u5b57\u7b26\u4e32\u683c\u5f0f\u7f16\u7801\u3002</p>"},{"location":"bep_0003/#left","title":"left","text":"<p>peer \u4ecd\u7136\u60f3\u8981\u4e0b\u8f7d\u7684\u5b57\u8282\u5927\u5c0f\uff0c\u4ee5\u5341\u8fdb\u5236\u5b57\u7b26\u4e32\u683c\u5f0f\u7f16\u7801\u3002 \u8fd9\u4e00\u9879\u4e0d\u80fd\u901a\u8fc7\u79cd\u5b50\u5bf9\u5e94\u7684\u6587\u4ef6\u5927\u5c0f\u548c\u5f53\u524d\u4e0b\u8f7d\u91cf\u8fdb\u884c\u8ba1\u7b97\uff0c \u56e0\u4e3apeer\u53ef\u80fd\u5728\u4e0b\u8f7d\u524d\u5c31\u62e5\u6709\u90e8\u5206\u6587\u4ef6\uff0c \u6216\u8005\u4ece\u522b\u7684\u8282\u70b9\u63a5\u6536\u5230\u4e86\u635f\u574f\u7684\u6570\u636e\u5bfc\u81f4\u67d0\u4e9b\u533a\u5757\u8fdb\u884c\u4e86\u91cd\u65b0\u4e0b\u8f7d\u3002</p>"},{"location":"bep_0003/#event","title":"event","text":"<p>\u53ef\u9009\u53c2\u6570\uff0c<code>started</code>, <code>completed</code>, \u6216\u8005 <code>stopped</code>\u3002\u6216\u8005\u4e3a\u7a7a\u5b57\u7b26\u4e32\uff0c\u8ddf\u4e0d\u4f20\u9012\u6b64\u53c2\u6570\u6548\u679c\u76f8\u540c\u3002</p> <p>\u5982\u679c\u672a\u4f20\u9012\u6b64\u53c2\u6570\uff0c\u5219\u8868\u793a\u8fd9\u662f\u5728\u5b9a\u671f\u6c47\u62a5\u3002</p> <p>\u5ba2\u6237\u7aef\u5728\u4e0b\u8f7d\u5f00\u59cb\u65f6\u6c47\u62a5 <code>started</code>\uff0c \u5728\u4e0b\u8f7d\u5b8c\u6210\u65f6\u6c47\u62a5 <code>completed</code>\u3002 \u5728\u5bf9\u5e94\u7684\u4e0b\u8f7d\u505c\u6b62\u65f6\u6c47\u62a5 <code>stopped</code></p> <p>\u5982\u679c\u672c\u5730\u6587\u4ef6\u5df2\u7ecf\u4e0b\u8f7d\u5b8c\u6210\uff0c\u4e0d\u9700\u8981\u6c47\u62a5 <code>started</code> \u4e8b\u4ef6\u3002</p>"},{"location":"bep_0003/#_4","title":"\u54cd\u5e94","text":"<p>tracker \u7684\u54cd\u5e94\u4e3a bencode \u7f16\u7801\u7684\u5b57\u5178\u3002</p> <p>\u5982\u679c\u6c47\u62a5\u5931\u8d25\uff0c\u5e94\u8be5\u5305\u542b\u4e00\u4e2a key <code>failure reason</code>\uff0c\u5bf9\u5e94\u7684\u503c\u5e94\u4e3a\u5b57\u7b26\u4e32\uff0c\u5305\u542b\u4e00\u4e2a\u4eba\u7c7b\u53ef\u8bfb\u7684\u9519\u8bef\u63cf\u8ff0\u3002</p> <p>\u5982\u679c\u6c47\u62a5\u6210\u529f\uff0c\u5e94\u8be5\u5305\u542b\u4e24\u4e2a key <code>interval</code> \u548c <code>peers</code>\u3002</p> <p><code>interval</code> \u7684\u503c\u4e3a\u6574\u6570\uff0c\u8868\u793a\u5ba2\u6237\u7aef\u4e0b\u4e00\u6b21\u8bf7\u6c42\u524d\u5e94\u8be5\u7b49\u5f85\u7684\u79d2\u6570\u3002</p> <p><code>peers</code> \u7684\u503c\u4e3a\u4e00\u4e2a\u5b57\u5178\u7ec4\u6210\u7684\u5217\u8868\uff08<code>list[dict]</code>\uff09\uff0c\u6bcf\u4e2a\u5b57\u5178\u5e94\u8be5\u5305\u542b keys <code>peer id</code>\uff0c<code>ip</code>, <code>port</code>\u3002</p> <p><code>ip</code> \u4e3a\u5b57\u7b26\u4e32\uff0c\u8868\u793a\u5176\u4ed6peer\u7684ip\u5730\u5740\u6216\u8005dns name\u3002<code>port</code> \u5219\u4e3a\u6570\u5b57\u3002<code>peer id</code> \u89c1\u524d\u6587\u3002</p> <p>peer \u4e5f\u6709\u53ef\u80fd\u8bf7\u6c42\u7d27\u51d1\uff08compact\uff09\u7684\u54cd\u5e94\uff0c\u5728bep 0023 \u4e2d\u8fdb\u884c\u5b9a\u4e49\u3002</p> <p>peers \u4e5f\u6709\u53ef\u80fd\u901a\u8fc7 UDP \u534f\u8bae\u8fdb\u884c\u6c47\u62a5\uff0c\u5728bep 15\u4e2d\u8fdb\u884c\u5b9a\u4e49\u3002</p>"},{"location":"bep_0003/#peer-protocol","title":"peer protocol","text":"<p>TODO</p>"},{"location":"bep_0023/","title":"bep 23 \u7d27\u51d1 Tracker \u54cd\u5e94","text":"<p>bep 23 \u539f\u59cb\u94fe\u63a5</p>"},{"location":"bep_0023/#_1","title":"\u6458\u8981","text":"<p>\u4e3a\u4e86\u51cf\u5c11tracker\u54cd\u5e94\u7684\u5927\u5c0f\uff0c\u548c\u51cf\u5c11tracker\u7684\u8d44\u6e90\u6d88\u8017\uff0ctracker\u53ef\u4ee5\u8fd4\u56de\u7d27\u51d1\u7684\u54cd\u5e94</p> <p>\u672c\u6587\u6863\u4e2d\u7684 \"MUST\", \"MUST NOT\", \"REQUIRED\", \"SHALL\", \"SHALL NOT\", \"SHOULD\", \"SHOULD NOT\", \"RECOMMENDED\", \"MAY\", and \"OPTIONAL\" \u7b49\u5173\u952e\u8bcd\u5b9a\u4e49\u4e0e IETF RFC 2119 <sup>1</sup> \u76f8\u540c.</p>"},{"location":"bep_0023/#overview","title":"Overview","text":"<p>\u5728 BEP 3<sup>2</sup> \u4e2d\u5b9a\u4e49\u4e86 tracker \u5982\u4f55\u54cd\u5e94 peers \u7684\u8bf7\u6c42\u3002This tracker returns a list of peers that are currently transferring the file. The list of peers is implemented as a list of bencoded dicts. Each dict in the list contains three fields: peer id, ip, and port. The peer id is 20 bytes plus 3 bytes bencoding overhead. The ip is a string containing a domain name or an IP address, and an integer port number. The ip is variable length, but since in its longest form it is a domain name it cannot exceed 255 bytes [2] plus 4 bytes bencoding overhead. Bencoded integers are also variable length but since it is a port number, it cannot be more than 7 bytes including bencoding overhead. Thus,</p> <pre><code>total peer list length in bytes &lt; n * ( 23 + 259 + 7 )\n</code></pre> <p>\u73b0\u5728tracker\u53ef\u4ee5\u4ee5\u4e00\u79cd\u66f4\u7d27\u51d1\u7684\u65b9\u5f0f\u8fdb\u884c\u54cd\u5e94\uff0c\u6bcf\u4e2aipv4\u5730\u5740\u4ec5\u4ec5\u9700\u89816\u5b57\u8282\u3002 \u524d4\u5b57\u8282\u8868\u793a32-bit\u7684ipv4\u5730\u5740\uff0c\u540e2\u5b57\u8282\u8868\u793a\u7aef\u53e3\u6570\uff0c\u5b57\u8282\u548c\u7aef\u53e3\u90fd\u4f7f\u7528\u7f51\u7edc\u5b57\u8282\u987a\uff0c\u4e5f\u5c31\u662f\u5927\u7aef\u5e8f\u3002</p> <p>\u5efa\u8bae\uff08SUGGESTED\uff09 tracker\u9ed8\u8ba4\u8fd4\u56de\u7d27\u51d1\u54cd\u5e94\u3002 \u5ba2\u6237\u7aef\u4e5f\u53ef\u4ee5\u5728\u8bf7\u6c42\u4e2d\u6dfb\u52a0 <code>compact=0</code> \u6765\u5efa\u8bae\u5ba2\u6237\u7aef\u4f18\u5148\u4f7f\u7528\u539f\u59cb\u683c\u5f0f\uff08bep3\u683c\u5f0f\uff09\u8fdb\u884c\u54cd\u5e94\uff0c \u4e5f\u53ef\u4ee5\u901a\u8fc7\u6dfb\u52a0 <code>compact=1</code> \u6765\u5efa\u8baetracker\u4f18\u5148\u4f7f\u7528\u7d27\u51d1\u683c\u5f0f\u8fdb\u884c\u54cd\u5e94\u3002</p> <p>\u5ba2\u6237\u7aef\u7684 <code>compact</code> \u53c2\u6570\u4ec5\u4ec5\u662f\u5efa\u8bae\u6027\u7684\uff0ctracker \u53ef\u4ee5\uff08MAY\uff09\u4efb\u610f\u9009\u62e9\u4e00\u79cd\u683c\u5f0f\uff0c \u5ba2\u6237\u7aef\u5fc5\u9700\uff08MUST\uff09\u540c\u65f6\u652f\u6301\u4e24\u79cd\u54cd\u5e94\u3002</p> <p>\u4f8b\u5982\uff1a</p> <pre><code>GET /announce?peer_id=aaaaaaaaaaaaaaaaaaaa&amp;info_hash=aaaaaaaaaaaaaaaaaaaa\n&amp;port=6881&amp;left=0&amp;downloaded=100&amp;uploaded=0&amp;compact=1\n</code></pre> <p>\u7d27\u51d1\u54cd\u5e94\u4ecd\u7136\u4f7f\u7528 <code>peers</code> key\uff0c\u4f46\u662f\u5bf9\u5e94\u7684\u503c\u662f\u4e8c\u8fdb\u5236\u5b57\u7b26\u4e32\uff0c\u800c\u975ebencode\u5217\u8868\u3002</p> <p>\u7d27\u51d1\u54cd\u5e94\u4e0d\u5305\u62ec <code>peer id</code>\u3002</p> <p>\u4f8b\u5982\uff1a <pre><code>import socket\nimport struct\nimport itertools\n\nfrom bencode2 import bdecode, bencode\n\n\npacker = struct.Struct(\"!4sH\")\n\n# encode response\n\nresponse = bencode({\n    \"interval\": 3600,\n    \"peers\": b\"\".join([\n        packer.pack(socket.inet_aton(addr), ip)\n        for addr, ip in [\n            (\"127.0.0.1\", 50014),\n            (\"1.1.1.1\", 49970),\n        ]\n    ]),\n})\n\n\n# decode response\n\n\ndef chunks(iterable, size):\n    it = iter(iterable)\n    chunk = tuple(itertools.islice(it, size))\n    while chunk:\n        yield chunk\n        chunk = tuple(itertools.islice(it, size))\n\n\npeers = bdecode(response)[b\"peers\"]\nfor i in range(0, len(peers), 6):\n    raw = peers[i : i + 6]\n    raw_addr, port = packer.unpack(raw)\n    print(socket.inet_ntoa(raw_addr), port)\n</code></pre></p> <ol> <li> <p>RFC-2119. http://www.ietf.org/rfc/rfc2119.txt \u3002\u4e2d\u6587\u4ecb\u7ecd http://www.ruanyifeng.com/blog/2007/03/rfc2119.html \u21a9</p> </li> <li> <p>BEP 0003 \u21a9</p> </li> </ol>"}]}